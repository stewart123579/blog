<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Reading books in Emacs | SVW Thunk'd</title><meta name=keywords content="emacs,emacs-config,ebooks,100daysToOffload"><meta name=description content="My Emacs configuration to allow reading EPUBs"><meta name=author content="Stewart V. Wright"><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://stewart123579.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stewart123579.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stewart123579.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://stewart123579.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://stewart123579.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.4.0/css/lightgallery-bundle.min.css integrity="sha512-91yJwfiGTCo9TM74ZzlAIAN4Eh5EWHpQJUfvo/XhpH6lzQtiRFkFRW1W+JSg4ch4XW3/xzh+dY4TOw/ILpavQA==" crossorigin=anonymous referrerpolicy=no-referrer><style>.flex-container{display:flex;flex-flow:row wrap;justify-content:space-around}</style><meta property="og:title" content="Reading books in Emacs"><meta property="og:description" content="My Emacs configuration to allow reading EPUBs"><meta property="og:type" content="article"><meta property="og:url" content="https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-15T00:00:00+10:00"><meta property="article:modified_time" content="2022-08-15T00:00:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Reading books in Emacs"><meta name=twitter:description content="My Emacs configuration to allow reading EPUBs"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://stewart123579.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Reading books in Emacs","item":"https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Reading books in Emacs","name":"Reading books in Emacs","description":"My Emacs configuration to allow reading EPUBs","keywords":["emacs","emacs-config","ebooks","100daysToOffload"],"articleBody":"You can read about my other Emacs configurations .\nI recently bought Mastering Emacs (I’ll share my thoughts in a future post) and it is provided in both EPUB and PDF format.\nNaturally I wanted to use Emacs to read the book, because:\nI didn’t want to open yet-another tool (Calibre I love you, but your ebook reader is sloooow and clunky)\nI wanted to be able to try things as I was reading them\n…you can safely evaluate elisp from an info buffer; a web browser session; or indeed anywhere else.\n– Evaluating Elisp in Emacs\nI wanted to be able to reference interesting things, bookmark them and add them to my notes or Zettelkasten\nThere’s a section in Mastering Emacs that mentions how to read EPUBs in Emacs, but here is how I set it up.\nIt’s in three steps:\nAdd ability to have a column of text in the centre of my window - this isn’t something required for reading books, it’s something I’ve wanted for a while. Make the centre column width adaptive to my window size Configure Emacs to open EPUBs visual-fill-column I like the option of distraction free reading and writing. That means sometimes, I want to have my text centred on my screen, but, also not taking up the full width (especially on a wide-screen monitor). I guess I could resize my window (frame in Emacs parlance), but the computer should do the work for me.\nSo I use visual-fill-column:\nThe primary purpose of visual-fill-column-mode is to wrap text at fill-column in buffers that use visual-line-mode.\nCentering the text - Another use case for visual-fill-column is to centre the text in a window. This effect is achieved by setting the user option visual-fill-column-center-text. Note that visual-fill-column-mode is not dependent on visual-line-mode, so it can be used to centre text in buffers that use auto-fill-mode or in programming modes.\nI simply added this to my setup:\n(use-package visual-fill-column) Adaptive centre column width I didn’t just want to have my centre column being defined by fill-column (the column beyond which automatic line-wrapping should happen), I wanted it to be adaptive. I want a comfortable centre column, wider for wide screens, but not too wide. How’s that for a hand-waving definition?\nSo I came up with my-centre-width - it calculates what the fill-column size should be for “comfortable” centring.\nFor small windows (window-width \u003c= 1.1 * fill-column) we simply return 90% of the fill-column; for larger windows we get the maximum of either half the current window-width or the fill-column. The max is there for something like fill-column being 100, and window-width being 120 - in that case the result would be 100 (fill-column), rather than 60 (half window-width).\n(defun my-centre-width () \"Return a fill column that makes centring pleasant regardless of screen size\" (let ((window-width (window-width))) (floor (if (\u003c= window-width (* 1.1 fill-column)) (* 0.9 window-width) (max (/ window-width 2) fill-column))))) As an aside: Don’t you just love that name spaces in (Common/Emacs) Lisp allow the function window-width to co-exist with the variable window-width!\nnov.el nov.el provides a major mode for reading EPUB documents.\nFollowing the README I’ve come up with the following variation…\n(use-package nov :init (defun my-nov-font-setup () (face-remap-add-relative 'variable-pitch :family \"Liberation Serif\" :height 1.3) (setq fill-column (my-centre-width) nov-text-width (- fill-column 2) visual-fill-column-center-text t)) :hook ((nov-mode . my-nov-font-setup) (nov-mode . visual-line-mode) (nov-mode . visual-fill-column-mode))) (add-to-list 'auto-mode-alist '(\"\\\\.epub\\\\'\" . nov-mode)) What I’ve done here is specified that I want the Liberation font. I’m setting the fill column to be my “comfortable” width (for visual-fill-column mode) and setting nov-text-width to be slightly smaller so that nov mode renders the text correctly in the centre of the screen.\nIf you don’t have the Liberation font installed (like I didn’t) and you use Homebrew as your package manager, it’s as simple as\nbrew install homebrew/cask-fonts/font-liberation …and then Reading EPUBs is as simple as opening the file!\n","wordCount":"649","inLanguage":"en","datePublished":"2022-08-15T00:00:00+10:00","dateModified":"2022-08-15T00:00:00+10:00","author":[{"@type":"Person","name":"Stewart V. Wright"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/"},"publisher":{"@type":"Organization","name":"SVW Thunk'd","logo":{"@type":"ImageObject","url":"https://stewart123579.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stewart123579.github.io/blog/ accesskey=h title="SVW Thunk'd (Alt + H)">SVW Thunk'd</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://stewart123579.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://stewart123579.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stewart123579.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stewart123579.github.io/blog/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://stewart123579.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://stewart123579.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Reading books in Emacs</h1><div class=post-meta><span title='2022-08-15 00:00:00 +1000 AEST'>August 15, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Stewart V. Wright</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#visual-fill-column aria-label=visual-fill-column><code>visual-fill-column</code></a></li><li><a href=#adaptive-centre-column-width aria-label="Adaptive centre column width">Adaptive centre column width</a></li><li><a href=#nov-dot-el aria-label=nov.el><code>nov.el</code></a></li><li><a href=#dot-dot-dot-and-then aria-label="&amp;hellip;and then">&mldr;and then</a></li></ul></div></details></div><div class=post-content><p>You can read about my other <a href=/blog/tags/emacs-config/>Emacs configurations </a>.</p><hr><p>I recently bought <a href=https://www.masteringemacs.org/>Mastering Emacs</a> (I&rsquo;ll share my thoughts in a future post) and
it is provided in both EPUB and PDF format.</p><p>Naturally I wanted to use Emacs to read the book, because:</p><ul><li><p>I didn&rsquo;t want to open yet-another tool (<a href=https://calibre-ebook.com/>Calibre</a> I love you, but your ebook
reader is sloooow and clunky)</p></li><li><p>I wanted to be able to try things as I was reading them</p><blockquote><p>&mldr;you can safely evaluate elisp from an info buffer; a web browser session;
or indeed anywhere else.</p></blockquote><p>&ndash; <a href=https://www.masteringemacs.org/article/evaluating-elisp-emacs>Evaluating Elisp in Emacs</a></p></li><li><p>I wanted to be able to reference interesting things, bookmark them and add
them to my <a href=/tags/orgmode/>notes</a> or <a href=/tags/pim/>Zettelkasten</a></p></li></ul><p>There&rsquo;s a section in <a href=https://www.masteringemacs.org/>Mastering Emacs</a> that mentions how to read EPUBs in Emacs,
but here is how I set it up.</p><p>It&rsquo;s in three steps:</p><ol><li>Add ability to have a column of text in the centre of my window - this isn&rsquo;t
something required for reading books, it&rsquo;s something I&rsquo;ve wanted for a while.</li><li>Make the centre column width adaptive to my window size</li><li>Configure Emacs to open EPUBs</li></ol><h2 id=visual-fill-column><code>visual-fill-column</code><a hidden class=anchor aria-hidden=true href=#visual-fill-column>#</a></h2><p>I like the option of distraction free reading and writing. That means sometimes,
I want to have my text centred on my screen, but, also not taking up the full
width (especially on a wide-screen monitor). I guess I could resize my window
(<code>frame</code> in Emacs parlance), but the computer should do the work for me.</p><p>So I use <code>visual-fill-column</code>:</p><blockquote><p>The primary purpose of visual-fill-column-mode is to wrap text at fill-column in
buffers that use visual-line-mode.</p></blockquote><p><strong>Centering the text</strong> - Another use case for visual-fill-column is to centre the
text in a window. This effect is achieved by setting the user option
<code>visual-fill-column-center-text</code>. Note that visual-fill-column-mode is not
dependent on <code>visual-line-mode</code>, so it can be used to centre text in buffers that
use <code>auto-fill-mode</code> or in programming modes.</p><p>I simply added this to my setup:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>use-package</span> <span style=color:#b8860b>visual-fill-column</span>)
</span></span></code></pre></div><h2 id=adaptive-centre-column-width>Adaptive centre column width<a hidden class=anchor aria-hidden=true href=#adaptive-centre-column-width>#</a></h2><p>I didn&rsquo;t <em>just</em> want to have my centre column being defined by <code>fill-column</code>
(the <em>column beyond which automatic line-wrapping should happen</em>), I wanted it
to be adaptive. I want a comfortable centre column, wider for wide screens, but
not too wide. <em>How&rsquo;s that for a hand-waving definition?</em></p><p>So I came up with <code>my-centre-width</code> - it calculates what the <code>fill-column</code> size
should be for &ldquo;comfortable&rdquo; centring.</p><p>For small windows (<code>window-width</code> &lt;= 1.1 * <code>fill-column</code>) we simply return 90%
of the <code>fill-column</code>; for larger windows we get the maximum of either half the
current <code>window-width</code> or the <code>fill-column</code>. The max is there for something like
<code>fill-column</code> being 100, and <code>window-width</code> being 120 - in that case the result
would be 100 (<code>fill-column</code>), rather than <code>60</code> (half <code>window-width</code>).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>defun</span> <span style=color:#b8860b>my-centre-width</span> ()
</span></span><span style=display:flex><span>  <span style=color:#b44>&#34;Return a fill column that makes centring pleasant regardless of screen size&#34;</span>
</span></span><span style=display:flex><span>  (<span style=color:#a2f>let</span> ((<span style=color:#b8860b>window-width</span> (<span style=color:#b8860b>window-width</span>)))
</span></span><span style=display:flex><span>    (<span style=color:#00a000>floor</span> (<span style=color:#a2f>if</span> (<span style=color:#00a000>&lt;=</span> <span style=color:#b8860b>window-width</span> (<span style=color:#00a000>*</span> <span style=color:#666>1.1</span> <span style=color:#b8860b>fill-column</span>))
</span></span><span style=display:flex><span>               (<span style=color:#00a000>*</span> <span style=color:#666>0.9</span> <span style=color:#b8860b>window-width</span>)
</span></span><span style=display:flex><span>             (<span style=color:#00a000>max</span> (<span style=color:#00a000>/</span> <span style=color:#b8860b>window-width</span> <span style=color:#666>2</span>) <span style=color:#b8860b>fill-column</span>)))))
</span></span></code></pre></div><p>As an aside: Don&rsquo;t you just love that <a href=/blog/posts/clues/removing-functions-and-variables-in-lisp/#why-does-common-lisp-appear-to-make-it-more-complicated>name spaces</a>
in (Common/Emacs) Lisp allow the <em>function</em> <code>window-width</code> to co-exist with the
variable <code>window-width</code>!</p><h2 id=nov-dot-el><code>nov.el</code><a hidden class=anchor aria-hidden=true href=#nov-dot-el>#</a></h2><p><a href=https://depp.brause.cc/nov.el/>nov.el</a> provides a major mode for reading EPUB documents.</p><p>Following the README I&rsquo;ve come up with the following variation&mldr;</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>use-package</span> <span style=color:#b8860b>nov</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f>:init</span> (<span style=color:#a2f>defun</span> <span style=color:#b8860b>my-nov-font-setup</span> ()
</span></span><span style=display:flex><span>          (<span style=color:#b8860b>face-remap-add-relative</span> <span style=color:#b8860b>&#39;variable-pitch</span> <span style=color:#a2f>:family</span> <span style=color:#b44>&#34;Liberation Serif&#34;</span>
</span></span><span style=display:flex><span>                                   <span style=color:#a2f>:height</span> <span style=color:#666>1.3</span>)
</span></span><span style=display:flex><span>          (<span style=color:#a2f>setq</span> <span style=color:#b8860b>fill-column</span> (<span style=color:#b8860b>my-centre-width</span>)
</span></span><span style=display:flex><span>                <span style=color:#b8860b>nov-text-width</span> (<span style=color:#00a000>-</span> <span style=color:#b8860b>fill-column</span> <span style=color:#666>2</span>)
</span></span><span style=display:flex><span>                <span style=color:#b8860b>visual-fill-column-center-text</span> <span style=color:#800>t</span>))
</span></span><span style=display:flex><span>  <span style=color:#a2f>:hook</span> ((<span style=color:#b8860b>nov-mode</span> <span style=color:#666>.</span> <span style=color:#b8860b>my-nov-font-setup</span>)
</span></span><span style=display:flex><span>         (<span style=color:#b8860b>nov-mode</span> <span style=color:#666>.</span> <span style=color:#b8860b>visual-line-mode</span>)
</span></span><span style=display:flex><span>         (<span style=color:#b8860b>nov-mode</span> <span style=color:#666>.</span> <span style=color:#b8860b>visual-fill-column-mode</span>)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#b8860b>add-to-list</span> <span style=color:#b8860b>&#39;auto-mode-alist</span> <span style=color:#666>&#39;</span>(<span style=color:#b44>&#34;\\.epub\\&#39;&#34;</span> <span style=color:#666>.</span> <span style=color:#b8860b>nov-mode</span>))
</span></span></code></pre></div><p>What I&rsquo;ve done here is specified that I want the <code>Liberation</code> font. I&rsquo;m setting
the fill column to be my <em>&ldquo;comfortable&rdquo;</em> width (for <code>visual-fill-column</code> mode)
and setting <code>nov-text-width</code> to be slightly smaller so that <code>nov</code> mode renders
the text correctly in the centre of the screen.</p><p>If you don&rsquo;t have the <code>Liberation</code> font installed (like I didn&rsquo;t) and you use
<a href=https://brew.sh>Homebrew</a> as your package manager, it&rsquo;s as simple as</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>brew install homebrew/cask-fonts/font-liberation
</span></span></code></pre></div><h2 id=dot-dot-dot-and-then>&mldr;and then<a hidden class=anchor aria-hidden=true href=#dot-dot-dot-and-then>#</a></h2><p>Reading EPUBs is as simple as opening the file!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://stewart123579.github.io/blog/tags/emacs/>Emacs</a></li><li><a href=https://stewart123579.github.io/blog/tags/emacs-config/>My Emacs configuration</a></li><li><a href=https://stewart123579.github.io/blog/tags/ebooks/>ebooks</a></li><li><a href=https://stewart123579.github.io/blog/tags/100daystooffload/>100daysToOffload</a></li></ul><nav class=paginav><a class=prev href=https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/><span class=title>« Prev Page</span><br><span>Creating ebooks</span></a>
<a class=next href=https://stewart123579.github.io/blog/posts/code/trimming-and-re-encoding-video-files/><span class=title>Next Page »</span><br><span>Trimming and re-encoding video files</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2023 <a href=https://stewart123579.github.io/blog/>SVW Thunk'd</a></span>
<span>|
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> |
<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a> |
<a href=https://www.gnu.org/software/emacs/ rel=noopener target=_blank>Emacs</a> |
<a href=https://orgmode.org/ rel=noopener target=_blank>Org Mode</a> |
<a href=https://ox-hugo.scripter.co/ rel=noopener target=_blank>ox-hugo</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>