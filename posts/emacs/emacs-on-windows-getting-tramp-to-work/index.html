<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Emacs on Windows: Getting tramp to work | SVW Thunk'd</title><meta name=keywords content="emacs,emacs-config,orgmode,100daysToOffload"><meta name=description content="Using Windows is&mldr;a challenge.  Running tramp in emacs, especially so."><meta name=author content="Stewart V. Wright"><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/emacs-on-windows-getting-tramp-to-work/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://stewart123579.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stewart123579.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stewart123579.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://stewart123579.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://stewart123579.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/emacs-on-windows-getting-tramp-to-work/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.4.0/css/lightgallery-bundle.min.css integrity="sha512-91yJwfiGTCo9TM74ZzlAIAN4Eh5EWHpQJUfvo/XhpH6lzQtiRFkFRW1W+JSg4ch4XW3/xzh+dY4TOw/ILpavQA==" crossorigin=anonymous referrerpolicy=no-referrer><style>.flex-container{display:flex;flex-flow:row wrap;justify-content:space-around}</style><meta property="og:title" content="Emacs on Windows: Getting tramp to work"><meta property="og:description" content="Using Windows is&mldr;a challenge.  Running tramp in emacs, especially so."><meta property="og:type" content="article"><meta property="og:url" content="https://stewart123579.github.io/blog/posts/emacs/emacs-on-windows-getting-tramp-to-work/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-24T00:00:00+10:00"><meta property="article:modified_time" content="2023-04-24T00:00:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Emacs on Windows: Getting tramp to work"><meta name=twitter:description content="Using Windows is&mldr;a challenge.  Running tramp in emacs, especially so."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://stewart123579.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Emacs on Windows: Getting tramp to work","item":"https://stewart123579.github.io/blog/posts/emacs/emacs-on-windows-getting-tramp-to-work/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Emacs on Windows: Getting tramp to work","name":"Emacs on Windows: Getting tramp to work","description":"Using Windows is\u0026hellip;a challenge.  Running tramp in emacs, especially so.","keywords":["emacs","emacs-config","orgmode","100daysToOffload"],"articleBody":"Using Windows is…a challenge. Running tramp in emacs, especially so.\nWhat is tramp? So what is TRAMP anyway?\nTramp allows you transparent access to files on remote access. “Transparent” means that usually the user doesn’t have to worry about anything. All that changes is the filename convention to indicate that the file resides on a remote system. One of the neat things about using Tramp via a remote shell, is that Emacs will then automatically invoke other remote shell commands directly on that server.\nEditing all occurs locally (so no remote desktop data heavy and slow process) and then is saved to the remote machine. It’s fast and extremely light weight and utterly brilliant when you mix it with babel in Org Mode you can have your literate programming running on a remote machine.\nWhat’s the problem? Where do I start? Let’s just assume you’ve got a working version of Emacs and ssh installed on your Windows machine.\nUsing tramp to connect to a remote host just…hangs.\nSo let’s solve that.\nDebugging tramp Debugging tramp starts with\n(setq tramp-verbose 3) ;; default (setq tramp-verbose 6) ;; useful (setq tramp-verbose 10) ;; lots of detail Pick your preferred verbosity and let’s go.\nAdding flags to ssh There’s a section in the tramp manual about the lack of pseudo-terminal support for cygwin. I found this was true still (and I don’t have cygwin). To check for compatibility: type M-x eshell RET, and start ssh test.host RET. Incompatibilities trigger this message:\nPseudo-terminal will not be allocated because stdin is not a terminal.\nThe option is to force a pseudo-terminal with the ssh flag -tt. I thought I could do it by setting connection information, but I couldn’t get it to work, so I’ve come up with, what I think is neat, solution:\n(when (eq system-type 'windows-nt) ;; Get the tramp-methods variable populated (require 'tramp) ;; Add the '-tt' flag to the login arguments for \"ssh\" ONLY (push '(\"-tt\") (cadr (assoc 'tramp-login-args (assoc \"ssh\" tramp-methods))))) That’s it. Add the -tt flag to the ssh login arguments.\nThere are all sorts of other explanations around the internet, long lisp functions, references (even in the GNU documentation) to using fakecygpty. We don’t need any of them.\nLine ending issues The next problem under Windows is the CRLF discrepancy from Unix systems.\nIf you run the following command in Org Mode\n#+begin_src sh :dir /ssh:my.host:~ uname -a #+end_src the error is:\nuname: invalid option -- '^M' Try 'uname --help' for more information. [ Babel evaluation exited with code 1 ] which I think is because tramp writes the command(s) to file and then sends the file to be executed (look at the debugging if you want more details).\nOne fix is to put a ; # at the end of every line, i.e. comment out the ^M, but there is a better way.\nThe way to resolve this is to tell Emacs that you prefer Unix encoding:\n(when (eq system-type 'windows-nt) (prefer-coding-system 'utf-8-unix)) Easy!\nSummary Tramp can be made to work under windows by simply:\nAdding the -tt flag to ssh login arguments Save your buffers with unix line endings ","wordCount":"523","inLanguage":"en","datePublished":"2023-04-24T00:00:00+10:00","dateModified":"2023-04-24T00:00:00+10:00","author":[{"@type":"Person","name":"Stewart V. Wright"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://stewart123579.github.io/blog/posts/emacs/emacs-on-windows-getting-tramp-to-work/"},"publisher":{"@type":"Organization","name":"SVW Thunk'd","logo":{"@type":"ImageObject","url":"https://stewart123579.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stewart123579.github.io/blog/ accesskey=h title="SVW Thunk'd (Alt + H)">SVW Thunk'd</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://stewart123579.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://stewart123579.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stewart123579.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stewart123579.github.io/blog/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://stewart123579.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://stewart123579.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Emacs on Windows: Getting tramp to work</h1><div class=post-meta><span title='2023-04-24 00:00:00 +1000 AEST'>April 24, 2023</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Stewart V. Wright</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-tramp aria-label="What is tramp?">What is tramp?</a></li><li><a href=#what-s-the-problem aria-label="What&amp;rsquo;s the problem?">What&rsquo;s the problem?</a></li><li><a href=#debugging-tramp aria-label="Debugging tramp">Debugging tramp</a></li><li><a href=#h%3af1f8c9e9-cd97-48a2-ae91-ad6eda181c75 aria-label="Adding flags to ssh">Adding flags to <code>ssh</code></a></li><li><a href=#h%3ab8670658-29f1-4071-86e2-6a2b5926faf3 aria-label="Line ending issues">Line ending issues</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><p>Using Windows is&mldr;a challenge. Running tramp in emacs, especially so.</p><h2 id=what-is-tramp>What is tramp?<a hidden class=anchor aria-hidden=true href=#what-is-tramp>#</a></h2><p>So what is <a href=https://www.emacswiki.org/emacs/TrampMode>TRAMP</a> anyway?</p><blockquote><p>Tramp allows you transparent access to files on remote access. “Transparent” means that usually the user doesn’t have to worry about anything. All that changes is the filename convention to indicate that the file resides on a remote system. One of the neat things about using Tramp via a remote shell, is that Emacs will then automatically invoke other remote shell commands directly on that server.</p></blockquote><p>Editing all occurs locally (so no remote desktop data heavy and slow process) and then is saved to the remote machine. It&rsquo;s <em>fast</em> and extremely light weight and utterly brilliant when you mix it with <a href=https://orgmode.org/worg/org-contrib/babel/>babel</a> in <a href=/tags/orgmode/>Org Mode</a> you can have your literate programming running on a remote machine.</p><h2 id=what-s-the-problem>What&rsquo;s the problem?<a hidden class=anchor aria-hidden=true href=#what-s-the-problem>#</a></h2><p>Where do I start? Let&rsquo;s just assume you&rsquo;ve got a working version of Emacs and ssh installed on your Windows machine.</p><p>Using tramp to connect to a remote host just&mldr;hangs.</p><p>So let&rsquo;s solve that.</p><h2 id=debugging-tramp>Debugging tramp<a hidden class=anchor aria-hidden=true href=#debugging-tramp>#</a></h2><p>Debugging tramp starts with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>setq</span> <span style=color:#b8860b>tramp-verbose</span> <span style=color:#666>3</span>)                  <span style=color:#080;font-style:italic>;; default</span>
</span></span><span style=display:flex><span>(<span style=color:#a2f>setq</span> <span style=color:#b8860b>tramp-verbose</span> <span style=color:#666>6</span>)                  <span style=color:#080;font-style:italic>;; useful</span>
</span></span><span style=display:flex><span>(<span style=color:#a2f>setq</span> <span style=color:#b8860b>tramp-verbose</span> <span style=color:#666>10</span>)                 <span style=color:#080;font-style:italic>;; lots of detail</span>
</span></span></code></pre></div><p>Pick your preferred verbosity and let&rsquo;s go.</p><h2 id=h:f1f8c9e9-cd97-48a2-ae91-ad6eda181c75>Adding flags to <code>ssh</code><a hidden class=anchor aria-hidden=true href=#h:f1f8c9e9-cd97-48a2-ae91-ad6eda181c75>#</a></h2><p>There&rsquo;s a section in the tramp manual about the <a href=https://www.gnu.org/software/tramp/#Issues-with-Cygwin-ssh>lack of pseudo-terminal support</a> for cygwin. I found this was true still (and I don&rsquo;t have cygwin). To check for compatibility: type <code>M-x eshell RET</code>, and start <code>ssh test.host RET</code>. Incompatibilities trigger this message:</p><blockquote><p>Pseudo-terminal will not be allocated because stdin is not a terminal.</p></blockquote><p>The option is to <a href=https://serverfault.com/questions/1113915/difference-between-t-and-tt-ssh>force a pseudo-terminal</a> with the <code>ssh</code> flag <code>-tt</code>. I thought I could do it by setting <a href=https://www.gnu.org/software/emacs/manual/html_node/tramp/Predefined-connection-information.html>connection information</a>, but I couldn&rsquo;t get it to work, so I&rsquo;ve come up with, what I think is neat, solution:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>when</span> (<span style=color:#00a000>eq</span> <span style=color:#b8860b>system-type</span> <span style=color:#b8860b>&#39;windows-nt</span>)
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>;; Get the tramp-methods variable populated</span>
</span></span><span style=display:flex><span>  (<span style=color:#a2f>require</span> <span style=color:#b8860b>&#39;tramp</span>)
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>;; Add the &#39;-tt&#39; flag to the login arguments for &#34;ssh&#34; ONLY</span>
</span></span><span style=display:flex><span>  (<span style=color:#a2f>push</span> <span style=color:#666>&#39;</span>(<span style=color:#b44>&#34;-tt&#34;</span>)
</span></span><span style=display:flex><span>        (<span style=color:#b8860b>cadr</span> (<span style=color:#00a000>assoc</span> <span style=color:#b8860b>&#39;tramp-login-args</span>
</span></span><span style=display:flex><span>                     (<span style=color:#00a000>assoc</span> <span style=color:#b44>&#34;ssh&#34;</span> <span style=color:#b8860b>tramp-methods</span>)))))
</span></span></code></pre></div><p>That&rsquo;s it. Add the <code>-tt</code> flag to the ssh login arguments.</p><p>There are all sorts of other explanations around the internet, long lisp functions, references (even in the GNU documentation) to using <code>fakecygpty</code>. We don&rsquo;t need any of them.</p><h2 id=h:b8670658-29f1-4071-86e2-6a2b5926faf3>Line ending issues<a hidden class=anchor aria-hidden=true href=#h:b8670658-29f1-4071-86e2-6a2b5926faf3>#</a></h2><p>The next problem under Windows is the CRLF discrepancy from Unix systems.</p><p>If you run the following command in Org Mode</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-org data-lang=org><span style=display:flex><span><span style=color:#080;font-style:italic>#+begin_src </span><span style=color:#080;font-weight:700>sh</span><span style=color:#080;font-style:italic> :dir /ssh:my.host:~
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  uname -a
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#+end_src</span>
</span></span></code></pre></div><p>the error is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>uname: invalid option -- &#39;^M&#39;
</span></span><span style=display:flex><span>Try &#39;uname --help&#39; for more information.
</span></span><span style=display:flex><span>[ Babel evaluation exited with code 1 ]
</span></span></code></pre></div><p>which I think is because tramp writes the command(s) to file and then sends the file to be executed (look at the debugging if you want more details).</p><p>One fix is to put a <code>; #</code> at the end of every line, i.e. comment out the <code>^M</code>, but there is a better way.</p><p>The way to resolve this is to tell Emacs that you prefer Unix encoding:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>when</span> (<span style=color:#00a000>eq</span> <span style=color:#b8860b>system-type</span> <span style=color:#b8860b>&#39;windows-nt</span>)
</span></span><span style=display:flex><span>  (<span style=color:#b8860b>prefer-coding-system</span> <span style=color:#b8860b>&#39;utf-8-unix</span>))
</span></span></code></pre></div><p>Easy!</p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>Tramp can be made to work under windows by simply:</p><ol><li>Adding the <code>-tt</code> <a href=#h:f1f8c9e9-cd97-48a2-ae91-ad6eda181c75>flag to ssh login arguments</a></li><li>Save your <a href=#h:b8670658-29f1-4071-86e2-6a2b5926faf3>buffers with unix line endings</a></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://stewart123579.github.io/blog/tags/emacs/>Emacs</a></li><li><a href=https://stewart123579.github.io/blog/tags/emacs-config/>My Emacs configuration</a></li><li><a href=https://stewart123579.github.io/blog/tags/orgmode/>Org Mode</a></li><li><a href=https://stewart123579.github.io/blog/tags/100daystooffload/>100daysToOffload</a></li></ul><nav class=paginav><a class=next href=https://stewart123579.github.io/blog/posts/using-mastodon-for-blog-comments/><span class=title>Next Page »</span><br><span>Using Mastodon for blog comments</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2023 <a href=https://stewart123579.github.io/blog/>SVW Thunk'd</a></span>
<span>|
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> |
<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a> |
<a href=https://www.gnu.org/software/emacs/ rel=noopener target=_blank>Emacs</a> |
<a href=https://orgmode.org/ rel=noopener target=_blank>Org Mode</a> |
<a href=https://ox-hugo.scripter.co/ rel=noopener target=_blank>ox-hugo</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>