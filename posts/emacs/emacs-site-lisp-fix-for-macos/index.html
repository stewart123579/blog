<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Emacs site-lisp fix for MacOS | SVW Thunk'd</title><meta name=keywords content="emacs,emacs-config,100daysToOffload"><meta name=description content="Emacs For MacOS (installed via Homebrew) doesn&rsquo;t use /usr/local/share/emacs/site-lisp.  Let&rsquo;s fix that."><meta name=author content="Stewart V. Wright"><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/emacs-site-lisp-fix-for-macos/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://stewart123579.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stewart123579.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stewart123579.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://stewart123579.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://stewart123579.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/emacs-site-lisp-fix-for-macos/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.4.0/css/lightgallery-bundle.min.css integrity="sha512-91yJwfiGTCo9TM74ZzlAIAN4Eh5EWHpQJUfvo/XhpH6lzQtiRFkFRW1W+JSg4ch4XW3/xzh+dY4TOw/ILpavQA==" crossorigin=anonymous referrerpolicy=no-referrer><style>.flex-container{display:flex;flex-flow:row wrap;justify-content:space-around}</style><meta property="og:title" content="Emacs site-lisp fix for MacOS"><meta property="og:description" content="Emacs For MacOS (installed via Homebrew) doesn&rsquo;t use /usr/local/share/emacs/site-lisp.  Let&rsquo;s fix that."><meta property="og:type" content="article"><meta property="og:url" content="https://stewart123579.github.io/blog/posts/emacs/emacs-site-lisp-fix-for-macos/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-26T00:00:00+10:00"><meta property="article:modified_time" content="2022-09-26T00:00:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Emacs site-lisp fix for MacOS"><meta name=twitter:description content="Emacs For MacOS (installed via Homebrew) doesn&rsquo;t use /usr/local/share/emacs/site-lisp.  Let&rsquo;s fix that."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://stewart123579.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Emacs site-lisp fix for MacOS","item":"https://stewart123579.github.io/blog/posts/emacs/emacs-site-lisp-fix-for-macos/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Emacs site-lisp fix for MacOS","name":"Emacs site-lisp fix for MacOS","description":"Emacs For MacOS (installed via Homebrew) doesn\u0026rsquo;t use /usr/local/share/emacs/site-lisp.  Let\u0026rsquo;s fix that.","keywords":["emacs","emacs-config","100daysToOffload"],"articleBody":"I noticed today that Emacs For Mac OS X (installed via Homebrew) doesn’t include /usr/local/share/emacs/site-lisp in the load-path, but Homebrew still installs Emacs packages in this path. It’s an easy fix to add this to your initialisation:\n(let ((default-directory \"/usr/local/share/emacs/site-lisp\")) (normal-top-level-add-subdirs-to-load-path)) You shouldn’t need to do this for Emacs in Linux installation. So you might want to wrap this in (when (eq system-type 'darwin) ...).\nAside 1: Lexical binding is so powerful If you don’t know what lexical binding is, I’d recommend you read about it. Here we define the variable default-directory, but this value only exists within this binding (i.e. calling normal-top-level-add-subdirs-to-load-path). Any value that existed prior to this command still remains outside of this construct.\nWhat this means is that we can set variables for specific cases, without worrying if they exist elsewhere, trying to remember to set them to the previous values after we do something, or anything like that. Powerful stuff.\nAside 2: Repeatedly adding the same directory? If you do something like this in your shell (bash/zsh/…)\nexport PATH=/my/new/path:$PATH # something export PATH=/my/new/path:$PATH you will get two copies of /my/new/path in your path. From painful experience this can get out-of-hand when you start shells within other shells…\nHowever, it’s not a problem with normal-top-level-add-subdirs-to-load-path, only new directories get added. You can prove this to yourself by running the command above a couple of times and then looking at the value of load-path.\nOr…you can see this by looking at the code.\nStart with describe-function (C-h f) on normal-top-level-add-subdirs-to-load-path and then see that it calls normal-top-level-add-to-load-path which (C-h f again) which does the uniqueness check.\nAgain, another reason why being able to dig right into what Emacs is doing is a superpower.\n","wordCount":"286","inLanguage":"en","datePublished":"2022-09-26T00:00:00+10:00","dateModified":"2022-09-26T00:00:00+10:00","author":[{"@type":"Person","name":"Stewart V. Wright"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://stewart123579.github.io/blog/posts/emacs/emacs-site-lisp-fix-for-macos/"},"publisher":{"@type":"Organization","name":"SVW Thunk'd","logo":{"@type":"ImageObject","url":"https://stewart123579.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stewart123579.github.io/blog/ accesskey=h title="SVW Thunk'd (Alt + H)">SVW Thunk'd</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://stewart123579.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://stewart123579.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stewart123579.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stewart123579.github.io/blog/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://stewart123579.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://stewart123579.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Emacs site-lisp fix for MacOS</h1><div class=post-meta><span title='2022-09-26 00:00:00 +1000 AEST'>September 26, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Stewart V. Wright</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#aside-1-lexical-binding-is-so-powerful aria-label="Aside 1: Lexical binding is so powerful">Aside 1: Lexical binding is so powerful</a></li><li><a href=#aside-2-repeatedly-adding-the-same-directory aria-label="Aside 2: Repeatedly adding the same directory?">Aside 2: Repeatedly adding the same directory?</a></li></ul></div></details></div><div class=post-content><p>I noticed today that <a href=https://emacsformacosx.com/>Emacs For Mac OS X</a> (installed via <a href=https://formulae.brew.sh/cask/emacs#default>Homebrew</a>) doesn&rsquo;t include
<code>/usr/local/share/emacs/site-lisp</code> in the <code>load-path</code>, but Homebrew still
installs Emacs packages in this path. It&rsquo;s an easy fix to add this to your initialisation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>let</span> ((<span style=color:#b8860b>default-directory</span>  <span style=color:#b44>&#34;/usr/local/share/emacs/site-lisp&#34;</span>))
</span></span><span style=display:flex><span>  (<span style=color:#b8860b>normal-top-level-add-subdirs-to-load-path</span>))
</span></span></code></pre></div><p>You shouldn&rsquo;t need to do this for Emacs in Linux installation. So you might want to wrap this in <code>(when (eq system-type 'darwin) ...)</code>.</p><h2 id=aside-1-lexical-binding-is-so-powerful>Aside 1: Lexical binding is so powerful<a hidden class=anchor aria-hidden=true href=#aside-1-lexical-binding-is-so-powerful>#</a></h2><p>If you don&rsquo;t know what <a href=https://www.gnu.org/software/emacs/manual/html_node/elisp/Lexical-Binding.html>lexical binding</a> is, I&rsquo;d recommend you read about it. Here we define the variable <code>default-directory</code>, but this value <em>only exists</em> within this binding (i.e. calling <code>normal-top-level-add-subdirs-to-load-path</code>). Any value that existed prior to this command still remains outside of this construct.</p><p>What this means is that we can set variables for specific cases, without worrying if they exist elsewhere, trying to remember to set them to the previous values after we do something, or anything like that. Powerful stuff.</p><h2 id=aside-2-repeatedly-adding-the-same-directory>Aside 2: Repeatedly adding the same directory?<a hidden class=anchor aria-hidden=true href=#aside-2-repeatedly-adding-the-same-directory>#</a></h2><p>If you do something like this in your shell (bash/zsh/&mldr;)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>PATH</span><span style=color:#666>=</span>/my/new/path:<span style=color:#b8860b>$PATH</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># something</span>
</span></span><span style=display:flex><span><span style=color:#a2f>export</span> <span style=color:#b8860b>PATH</span><span style=color:#666>=</span>/my/new/path:<span style=color:#b8860b>$PATH</span>
</span></span></code></pre></div><p>you will get two copies of <code>/my/new/path</code> in your path. From painful experience this can get out-of-hand when you start shells within other shells&mldr;</p><p>However, it&rsquo;s not a problem with <code>normal-top-level-add-subdirs-to-load-path</code>, only new directories get added. You can prove this to yourself by running the command above a couple of times and then looking at the value of <code>load-path</code>.</p><p><strong>Or&mldr;you can see this by looking at the code.</strong></p><p>Start with <code>describe-function</code> (<code>C-h f</code>) on <code>normal-top-level-add-subdirs-to-load-path</code> and then see that it calls <code>normal-top-level-add-to-load-path</code> which (<code>C-h f</code> again) which does the uniqueness check.</p><p>Again, another reason why being able to dig right into what Emacs is doing is a <em>superpower</em>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://stewart123579.github.io/blog/tags/emacs/>Emacs</a></li><li><a href=https://stewart123579.github.io/blog/tags/emacs-config/>My Emacs configuration</a></li><li><a href=https://stewart123579.github.io/blog/tags/100daystooffload/>100daysToOffload</a></li></ul><nav class=paginav><a class=prev href=https://stewart123579.github.io/blog/posts/using-mastodon-for-blog-comments/><span class=title>« Prev Page</span><br><span>Using Mastodon for blog comments</span></a>
<a class=next href=https://stewart123579.github.io/blog/posts/psa-re-encode-your-mov-files/><span class=title>Next Page »</span><br><span>PSA - re-encode your MOV files</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2023 <a href=https://stewart123579.github.io/blog/>SVW Thunk'd</a></span>
<span>|
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> |
<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a> |
<a href=https://www.gnu.org/software/emacs/ rel=noopener target=_blank>Emacs</a> |
<a href=https://orgmode.org/ rel=noopener target=_blank>Org Mode</a> |
<a href=https://ox-hugo.scripter.co/ rel=noopener target=_blank>ox-hugo</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>