<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Creating ebooks | SVW Thunk'd</title><meta name=keywords content="emacs,emacs-config,books,orgmode,ebooks,100daysToOffload"><meta name=description content="Creating ebooks in Emacs with orgmode is easy"><meta name=author content="Stewart V. Wright"><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.b4e19c453811e60acfec1f00c15ac2be1c53f6ab90187e684358ce7faaf48bab.css integrity="sha256-tOGcRTgR5grP7B8AwVrCvhxT9quQGH5oQ1jOf6r0i6s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://stewart123579.github.io/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://stewart123579.github.io/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://stewart123579.github.io/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://stewart123579.github.io/blog/apple-touch-icon.png><link rel=mask-icon href=https://stewart123579.github.io/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=canonical href=https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.4.0/css/lightgallery-bundle.min.css integrity="sha512-91yJwfiGTCo9TM74ZzlAIAN4Eh5EWHpQJUfvo/XhpH6lzQtiRFkFRW1W+JSg4ch4XW3/xzh+dY4TOw/ILpavQA==" crossorigin=anonymous referrerpolicy=no-referrer><style>.flex-container{display:flex;flex-flow:row wrap;justify-content:space-around}</style><meta property="og:title" content="Creating ebooks"><meta property="og:description" content="Creating ebooks in Emacs with orgmode is easy"><meta property="og:type" content="article"><meta property="og:url" content="https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-16T00:00:00+10:00"><meta property="article:modified_time" content="2022-08-16T00:00:00+10:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Creating ebooks"><meta name=twitter:description content="Creating ebooks in Emacs with orgmode is easy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://stewart123579.github.io/blog/posts/"},{"@type":"ListItem","position":2,"name":"Creating ebooks","item":"https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Creating ebooks","name":"Creating ebooks","description":"Creating ebooks in Emacs with orgmode is easy","keywords":["emacs","emacs-config","books","orgmode","ebooks","100daysToOffload"],"articleBody":"When I was looking up the Murderbot series I realised that there were a couple that I’d not read. Two turned out to be short stories (one for Wired and one for TOR) and both were available on the web.\nHowever, “on the web” is not on my Kindle and in Calibre, so I thought about converting them into EPUBs - but how? My thoughts, naturally, went to Org mode and when I searched there was indeed an EPUB exporter. I also checked and both have covers (one fan made).\nInstall the epub exporter Installing the EPUB exporter is as easy as adding the following to your emacs configuration:\n(use-package ox-epub :load-path \"lisp/ox-epub\" :demand t) Aside 1 Why the :demand t? use-package normally defers loading of packages until they are needed, however, this isn’t a package, it extends orgmode, so we demand it to be loaded Aside 2 Why the :load-path? You’re going to have to read the Testing and bug fixes section below. Create a snippet Reading the documentation I realised that where were some options that need to be set.\nUID a unique id of the document, otherwise known as uri, may be a url DATE the date of the document AUTHOR the document author or editor, the creator in the EPUB spec TITLE the document title There were also some optional properties that I thought I might want to set:\nSubject the subject matter of the book Description a description of the book Publisher the publisher of the book License the rights associated with this book, the copyright notice, etc. EPUBCOVER the cover image to use for the export So, the easiest way was to create a snippet for yasnippet (I save this in ~/.emacs.d/snippets/org-mode/epub):\n# -*- mode:id snippet -*- # name: EPUB export headers # key: epub # -- #+TITLE: ${1} #+UID: ${2:`(org-id-new)`} #+DATE: ${3:`(me/date-iso)`} #+AUTHOR: ${4:Stewart V. Wright} #+EPUBCOVER: ${5} # #+Subject: the subject matter of the book # #+Description: a description of the book # #+Publisher: the publisher of the book # #+License: copyright notice and further rights Testing and bug fixes I did all of these steps and then generated an EPUB. It didn’t open.\nSo I started to dig into it… I downloaded epubcheck, I downloaded the latest openjdk container for docker (docker pull openjdk:latest) and then tested the EPUB I generated.\nOne of the errors was:\nERROR(PKG-007): sample.epub/mimetype(-1,-1): Mimetype file should only contain the string \"application/epub+zip\" and should not be compressed. I looked at the sample EPUB in the ox-epub repository (did you know that EPUBs are simply zip files?) and realised that the file I was generating had a new line in the mimetype file. This made me think for a bit and I remembered that I have require-final-newline set in my Emacs configuaration - this option puts a newline at the end if there isn’t already one there. In most cases this is what I want…but not here.\nSo I modified ox-epub and submitted a pull request. Whilst that is not merged, you can use my modified version of the code.\nFinally Now I have my two new Murderbot stories, ready for reading on any of my devices.\n","wordCount":"529","inLanguage":"en","datePublished":"2022-08-16T00:00:00+10:00","dateModified":"2022-08-16T00:00:00+10:00","author":[{"@type":"Person","name":"Stewart V. Wright"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://stewart123579.github.io/blog/posts/emacs/creating-ebooks/"},"publisher":{"@type":"Organization","name":"SVW Thunk'd","logo":{"@type":"ImageObject","url":"https://stewart123579.github.io/blog/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://stewart123579.github.io/blog/ accesskey=h title="SVW Thunk'd (Alt + H)">SVW Thunk'd</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://stewart123579.github.io/blog/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://stewart123579.github.io/blog/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://stewart123579.github.io/blog/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://stewart123579.github.io/blog/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://stewart123579.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://stewart123579.github.io/blog/posts/>Posts</a></div><h1 class=post-title>Creating ebooks</h1><div class=post-meta><span title='2022-08-16 00:00:00 +1000 AEST'>August 16, 2022</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Stewart V. Wright</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#install-the-epub-exporter aria-label="Install the epub exporter">Install the epub exporter</a></li><li><a href=#create-a-snippet aria-label="Create a snippet">Create a snippet</a></li><li><a href=#testing-and-bug-fixes aria-label="Testing and bug fixes">Testing and bug fixes</a></li><li><a href=#finally aria-label=Finally>Finally</a></li></ul></div></details></div><div class=post-content><p>When I was looking up the <a href=https://en.m.wikipedia.org/wiki/The_Murderbot_Diaries>Murderbot</a> series I realised that there were a couple
that I&rsquo;d not read. Two turned out to be short stories (one <a href=https://www.wired.com/story/future-of-work-compulsory-martha-wells/>for Wired</a> and one <a href=https://www.wired.com/story/future-of-work-compulsory-martha-wells/>for
TOR</a>) and both were available on the web.</p><p>However, <em>&ldquo;on the web&rdquo;</em> is <strong>not</strong> on my Kindle and in Calibre, so I thought about
converting them into EPUBs - but how? My thoughts, naturally, went to <a href=/tags/orgmode/>Org mode</a>
and when I searched there was indeed an <a href=https://github.com/ofosos/ox-epub>EPUB exporter</a>. I also checked and both
have covers (one fan made).</p><h2 id=install-the-epub-exporter>Install the epub exporter<a hidden class=anchor aria-hidden=true href=#install-the-epub-exporter>#</a></h2><p>Installing the EPUB exporter is as easy as adding the following to your emacs
configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-emacs-lisp data-lang=emacs-lisp><span style=display:flex><span>(<span style=color:#a2f>use-package</span> <span style=color:#b8860b>ox-epub</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f>:load-path</span> <span style=color:#b44>&#34;lisp/ox-epub&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f>:demand</span> <span style=color:#800>t</span>)
</span></span></code></pre></div><dl><dt>Aside 1</dt><dd>Why the <code>:demand t</code>? <a href=https://jwiegley.github.io/use-package/><code>use-package</code></a> normally defers loading of
packages until they are needed, however, this isn&rsquo;t a package, it extends
orgmode, so we <code>demand</code> it to be loaded</dd><dt>Aside 2</dt><dd>Why the <code>:load-path</code>? You&rsquo;re going to have to read the
<a href=#testing-and-bug-fixes>Testing and bug fixes</a> section below.</dd></dl><h2 id=create-a-snippet>Create a snippet<a hidden class=anchor aria-hidden=true href=#create-a-snippet>#</a></h2><p>Reading the documentation I realised that where were some options that need to
be set.</p><dl><dt>UID</dt><dd>a unique id of the document, otherwise known as uri, may be a url</dd><dt>DATE</dt><dd>the date of the document</dd><dt>AUTHOR</dt><dd>the document author or editor, the creator in the EPUB spec</dd><dt>TITLE</dt><dd>the document title</dd></dl><p>There were also some optional properties that I thought I might want to set:</p><dl><dt>Subject</dt><dd>the subject matter of the book</dd><dt>Description</dt><dd>a description of the book</dd><dt>Publisher</dt><dd>the publisher of the book</dd><dt>License</dt><dd>the rights associated with this book, the copyright notice, etc.</dd><dt>EPUBCOVER</dt><dd>the cover image to use for the export</dd></dl><p>So, the easiest way was to create a snippet for yasnippet (I save this in
<code>~/.emacs.d/snippets/org-mode/epub</code>):</p><pre tabindex=0><code class=language-snippet data-lang=snippet># -*- mode:id snippet -*-
# name: EPUB export headers
# key: epub
# --

#+TITLE: ${1}
#+UID: ${2:`(org-id-new)`}
#+DATE: ${3:`(me/date-iso)`}
#+AUTHOR: ${4:Stewart V. Wright}
#+EPUBCOVER: ${5}
# #+Subject: the subject matter of the book
# #+Description: a description of the book
# #+Publisher: the publisher of the book
# #+License: copyright notice and further rights
</code></pre><h2 id=testing-and-bug-fixes>Testing and bug fixes<a hidden class=anchor aria-hidden=true href=#testing-and-bug-fixes>#</a></h2><p>I did all of these steps and then generated an EPUB. It didn&rsquo;t open.</p><p>So I started to dig into it&mldr; I downloaded <a href=https://github.com/w3c/epubcheck>epubcheck</a>, I downloaded the latest
openjdk container for docker (<code>docker pull openjdk:latest</code>) and then tested the
EPUB I generated.</p><p><a href=https://github.com/ofosos/ox-epub/issues/35>One of the errors</a> was:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ERROR(PKG-007): sample.epub/mimetype(-1,-1): Mimetype file should only contain the string &#34;application/epub+zip&#34; and should not be compressed.
</span></span></code></pre></div><p>I looked at the <a href=https://github.com/ofosos/ox-epub/blob/master/sample/sample.epub>sample EPUB</a> in the <code>ox-epub</code> repository (did you know that EPUBs
are simply zip files?) and realised that the file I was generating had a new
line in the <code>mimetype</code> file. This made me think for a bit and I remembered that
I have <code>require-final-newline</code> set in my Emacs configuaration - <a href=https://www.gnu.org/software/emacs/manual/html_node/emacs/Customize-Save.html>this option</a> puts
a newline at the end if there isn’t already one there. In most cases this is
what I want&mldr;but not here.</p><p>So I modified <code>ox-epub</code> and submitted a <a href=https://github.com/ofosos/ox-epub/pull/36>pull request</a>. Whilst that is not merged,
you can use <a href=https://github.com/stewart123579/ox-epub/tree/fix-epubcheck>my modified version</a> of the code.</p><h2 id=finally>Finally<a hidden class=anchor aria-hidden=true href=#finally>#</a></h2><p>Now I have my two new Murderbot stories, ready for reading on any of my devices.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://stewart123579.github.io/blog/tags/emacs/>Emacs</a></li><li><a href=https://stewart123579.github.io/blog/tags/emacs-config/>My Emacs configuration</a></li><li><a href=https://stewart123579.github.io/blog/tags/books/>books</a></li><li><a href=https://stewart123579.github.io/blog/tags/orgmode/>Org Mode</a></li><li><a href=https://stewart123579.github.io/blog/tags/ebooks/>ebooks</a></li><li><a href=https://stewart123579.github.io/blog/tags/100daystooffload/>100daysToOffload</a></li></ul><nav class=paginav><a class=prev href=https://stewart123579.github.io/blog/posts/book-week-2022/><span class=title>« Prev Page</span><br><span>Book Week 2022</span></a>
<a class=next href=https://stewart123579.github.io/blog/posts/emacs/reading-books-in-emacs/><span class=title>Next Page »</span><br><span>Reading books in Emacs</span></a></nav></footer></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2023 <a href=https://stewart123579.github.io/blog/>SVW Thunk'd</a></span>
<span>|
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> |
<a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a> |
<a href=https://www.gnu.org/software/emacs/ rel=noopener target=_blank>Emacs</a> |
<a href=https://orgmode.org/ rel=noopener target=_blank>Org Mode</a> |
<a href=https://ox-hugo.scripter.co/ rel=noopener target=_blank>ox-hugo</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>